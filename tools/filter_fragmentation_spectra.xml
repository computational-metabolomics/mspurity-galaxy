<tool id="filter_frag_spectra" name="msPurity.filterFragSpectra" version="0.0.1">
    <description>
      Filter fragmentation spectra
    </description>

    <macros>
        <import>macros.xml</import>
    </macros>

    <expand macro="requirements">
    </expand>

 <stdio>
        <exit_code range="1:" />
    </stdio>
    <command interpreter="Rscript"><![CDATA[
        filter_fragmentation_spectra.R
            --out_rdata="$filter_fragmentation_spectra_rdata"
            --out_peaklist_prec="$peaklist_prec_tsv"
            --out_peaklist_frag="$peaklist_frag_tsv"
            --pa="$pa"
            --ilim=$ilim
            --plim=$plim
            --ra=$ra
            --snr=$snr
            --snmeth=$snmeth

            $rmp
    ]]></command>
    <inputs>
        <param name="pa" type="data" label="purityA object" format="rdata"
               help="purityA object saved as 'pa' in a RData file (output from frag4feature tool)"/>

        <param name="plim" type="float" value="0.5" label="Miniumum precursor ion purity of the associated precursor for fragmentation spectra scan" help="" />

        <param name="ilim" type="float" value="0.0" label="Peak instensity threshold" help="" />

        <param name="ra" type="float" min="0.0" max="1.0" value="0.0" label="Relative abundance threshold" help="" />

        <param name="snr" type="float" value="0.0" label="Signal-to-noise threshold" help="" />
        <param name="snmeth" type="select" label="Function to calculate noise." help="" >
            <option value="median" selected="true">median</option>
            <option value="mean">mean</option>
            <!-- <option value="mad">mad</option> -->
        </param>

        <param name="rmp" type="boolean" checked="false" truevalue="--remove_peaks" falsevalue="" label="Remove peaks that do not meet the filtering criteria. Otherwise peaks will be flagged instead."
               help="" />
    </inputs>
    <outputs>
        <data name="filter_fragmentation_spectra_rdata" format="rdata" label="${tool.name} on ${on_string}: RData" />
        <data name="peaklist_prec_tsv" format="tsv" label="${tool.name} on ${on_string}: peaklist (precursors)" />
        <data name="peaklist_frag_tsv" format="tsv" label="${tool.name} on ${on_string}: peaklist (fragments)" />
    </outputs>
    <tests>
        <test>
            <param name="pa" value="frag4feature_LCMS_1_LCMS_2_LCMSMS_1_LCMSMS_2.RData" />
            <output name="filter_fragmentation_spectra_rdata" file="filter_fragmentation_spectra_LCMS_1_LCMS_2_LCMSMS_1_LCMSMS_2.RData" ftype="rdata" compare="sim_size" />
            <output name="peaklist_prec_tsv" file="peaklist_filter_precursors.tsv" ftype="tsv" />
            <output name="peaklist_frag_tsv" file="peaklist_filter_fragments.tsv" ftype="tsv" />
        </test>
    </tests>

    <help><![CDATA[
=============================================================
Filter Fragmentation Spectra
=============================================================
-----------
Description
-----------

Tool to .


The data inputs are:

*

See Bioconductor documentation for more details, functions:
msPurity::filterFragSpectra()

-----------
Outputs
-----------
* filter_fragmentation_spectra_rdata
* peaklist_prec_tsv
* peaklist_frag_tsv

    ]]></help>

    <expand macro="citations" />

</tool>
