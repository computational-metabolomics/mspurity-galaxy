<tool id="average_x_frag_spectra" name="Average and filter fragmentation spectra" version="0.0.1">
    <description>
        (Inter, Intra or All)
    </description>

    <macros>
        <import>macros.xml</import>
    </macros>

    <expand macro="requirements">
    </expand>

 <stdio>
        <exit_code range="1:" />
    </stdio>
    <command interpreter="Rscript"><![CDATA[
        average_fragmentation_spectra.R
            --sm_resultPth="$sm_resultPth"
            --metfrag_resultPth="$metfrag_resultPth"
            --sirius_csi_resultPth="$sirius_csi_resultPth"
            --probmetab_resultPth="$probmetab_resultPth"
            --sm_weight=$sm_weight
            --metfrag_weight=$metfrag_weight
            --sirius_csi_weight=$sirius_csi_weight
            --probmetab_weight=$probmetab_weight
            #if $create_new_database:
              --create_new_database
            #end if
            
    ]]></command>
    <inputs>
       <param name="sm_resultPth" type="data" label="Spectral matching result" format="sqlite"
               help="The SQLite database generated from msPurity.spectralMatching"/>
       <param name="metfrag_resultPth" type="data" label="Metfrag result" format="tsv,tabular"
               help="The result of the MetFrag analysis (requires a column indicating the XCMS group ID and fragmentation spectra ID)"/>
       <param name="sirius_csi_resultPth" type="data" label="Sirius CSI:FingerID result" format="tsv,tabular"
               help="The result of the CSI:FingerID analysis (requires a column indicating the XCMS group ID and fragmentation spectra ID)"/>
       <param name="probmetab_resultPth" type="data" label="Probmetab result" format="tsv,tabular"
               help="The result of the Probmetab analysis (requires a column indicating the XCMS group ID and fragmentation spectra ID)"/>
       <param name="sm_weight" type="float" min="0.0" max="1.0" value="0.4" label="Spectral matching weight" help="all weights need to sum to 1" />
       <param name="metfrag_weight" type="float" min="0.0" max="1.0" value="0.2" label="Metfrag weight" help="all weights need to sum to 1" /> 
       <param name="sirius_csi_weight" type="float" min="0.0" max="1.0" value="0.2" label="Sirius CSI weight" help="all weights need to sum to 1" />
       <param name="probmetab_weight" type="float" min="0.0" max="1.0" value="0.1" label="Probmetab weight" help="all weights need to sum to 1" />
       <param name="probmetab_weight" type="float" min="0.0" max="1.0" value="0.1" label="Probmetab weight" help="all weights need to sum to 1" /> 
       <param name="create_new_database" type="boolean" checked="true" label="Create a new database for the results?"
               help="A copy will be made of the input SQLite spectral matching database and the results will be added to this copy.
                     When False, the input SQLite database will be updated the results. Use False
                     if you want to reduce storage space being used."/>
    </inputs>
    <outputs>
        <data name="combined_annotation_sqlite" format="sqlite" label="${tool.name} (${av.level}) on ${on_string}: sqlite" />
        <data name="combined_annotation_tsv" format="tsv" label="${tool.name} (${av.level}) on ${on_string}: tsv" />
    </outputs>
    <tests>
        <test>
            <param name="sm_resultPth" value="sm_result_for_combine_annotation.sqlite" />
            <param name="metfrag_resultPth" value="metfrag.tsv" />
            <param name="sirius_csi_resultPth" value="sirus_csi_fingerid.tsv" />
            <param name="probmetab_resultPth" value="probmetab.tsv" />
            <output name="combined_annotation_tsv" file="combined_annotation_tsv" ftype="tsv" />
            <output name="combined_annotation_sqlite" file="combined_annotation_sqlite" ftype="tsv" />
        </test>
    </tests>
    
    <help><![CDATA[
=============================================================
Combine annotation results
=============================================================
-----------
Description
-----------

Tool to . 


The data inputs are:

* 

See Bioconductor documentation for more details, functions:
msPurity::combineAnnotation()

-----------
Outputs
-----------
* combined_annotation_sqlite
* combined_annotation_tsv

    ]]></help>

<expand macro="citations" />

</tool>
